$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "http://purl.org/iscc/schema/iscc-global-match.json"
title: "IsccGlobalMatch"
type: object
description: |
  A single match result from ISCC lookup search. Contains the matched ISCC-ID,
  aggregated score, and detailed bit-match breakdown per unit_type.
required:
  - iscc_id
  - score
  - types
properties:
  iscc_id:
    type: string
    description: The matched ISCC-ID from the index
    pattern: "^ISCC:[A-Z2-7]{16,}$"
    example: "ISCC:MAIGIIFJRDGEQQAA"
  score:
    type: number
    description: |
      Overall similarity score (0.0-1.0), computed as the average of matched
      unit similarities across all queried units.

      **Score semantics**:
      - 1.0: Perfect match (all queried units matched exactly)
      - 0.0-1.0: Partial match (some units matched with varying similarity)
      - Higher score indicates better overall match

      This normalized score enables direct comparison across matches regardless
      of the number or types of units queried.
    minimum: 0.0
    maximum: 1.0
    example: 0.850
  types:
    type: object
    description: |
      Per-unit-type similarity breakdown. Keys are unit type identifiers
      (e.g., "META_NONE_V0", "CONTENT_TEXT_V0"), values are similarity scores (0.0-1.0).

      **Missing keys**: Unit types that were queried but not found in this asset
      are omitted (implicitly 0.0).

      **Score semantics** (normalized against query unit length):
      - 1.0: Perfect match (all query bits matched)
      - 0.0-1.0: Partial match (NPHD distance for similarity-preserving units)
      - INSTANCE units: Binary scoring (1.0 = identity match, 0.0 = no match)

      A 64-bit query with perfect 64-bit match scores 1.0, same as 256-bit perfect match.
      Score reflects "how well does this match MY query", not absolute bit count.
    additionalProperties:
      type: number
      minimum: 0.0
      maximum: 1.0
    minProperties: 1
    example:
      META_NONE_V0: 1.0
      CONTENT_TEXT_V0: 1.0
      DATA_NONE_V0: 1.0
      INSTANCE_NONE_V0: 0.25
  metadata:
    $ref: "./IsccMetadata.yaml"
    description: |
      Optional asset metadata, denormalized from the index for convenience.
      Useful for result rendering and client-side filtering without additional lookups.

      This field allows clients to access asset metadata directly in search results
      without requiring additional get_asset() calls.
example:
  iscc_id: "ISCC:MAIGIIFJRDGEQQAA"
  score: 0.850
  types:
    META_NONE_V0: 1.0
    CONTENT_TEXT_V0: 1.0
    DATA_NONE_V0: 1.0
    INSTANCE_NONE_V0: 0.25
  metadata:
    name: "Example Document"
    filename: "example.pdf"
