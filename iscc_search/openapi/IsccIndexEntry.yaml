$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "http://purl.org/iscc/schema/iscc-index-entry.json"
title: "IsccIndexEntry"
type: object
description: |
  Unified entry format for adding assets to an ISCC index.

  Supports three indexing modes:

  1. **Asset-level indexing** (`iscc_code` or `units`): Enable global similarity matching
  2. **Chunk-level indexing** (`simprints`): Enable granular segment matching
  3. **Combined indexing**: Both asset-level and chunk-level for comprehensive discovery

  **Requirements**:
  - `iscc_id` is always required (the persistent identifier for this asset)
  - At least one of `iscc_code`, `units`, or `simprints` must be provided

  **Storage model**:
  - Asset metadata (iscc_id, units, metadata) stored once per asset
  - Simprints stored per-segment with parent iscc_id reference
  - Backend automatically decomposes iscc_code into units for indexing
required:
  - iscc_id
properties:
  iscc_id:
    type: string
    description: |
      Globally unique digital asset identifier (ISCC-ID).

      This persistent identifier links all indexed data (units and simprints) to the
      same logical asset. Required for all indexing operations.
    pattern: "^ISCC:[A-Z2-7]{16,}$"
    example: "ISCC:MAIGIIFJRDGEQQAA"
  iscc_code:
    type: string
    description: |
      Composite ISCC-CODE combining multiple ISCC-UNITs.

      The backend automatically decomposes this into individual units for indexing in
      unit-specific indexes. Can be used instead of or in addition to explicit `units`.

      **Note**: If both `iscc_code` and `units` are provided, the backend merges them
      (duplicate units are stored once).
    pattern: "^ISCC:[A-Z2-7]{16,}$"
    example: "ISCC:KADUHBUDQUT3LPWRJH6BUAG7HMBIXX6JRQRX3JH7EBIOSMXEVL5URBBUPOIOTU4HLSSQ"
  units:
    type: array
    description: |
      Explicit list of ISCC-UNITs for asset-level indexing.

      Use this for fine-grained control over which units are indexed (e.g., indexing
      only specific unit types or extended 256-bit units).

      **Note**: If both `iscc_code` and `units` are provided, the backend merges them
      (duplicate units are stored once).
    items:
      type: string
      pattern: "^ISCC:[A-Z2-7]{16,}$"
    minItems: 1
    example:
      - "ISCC:AAAUHBUDQUT3LPWR"
      - "ISCC:CAAUT7A2ADPTWAUL"
      - "ISCC:EAA57SMMEN62J7ZA"
      - "ISCC:GAAVB2JS4SVPWSEE"
      - "ISCC:IAATI64Q5HJYOXFF"
  metadata:
    $ref: "./IsccMetadata.yaml"
    description: |
      Optional application-specific metadata.

      Stored with the asset and returned in search results. Useful for client-side
      rendering, filtering, and business logic.
  simprints:
    type: object
    description: |
      Simprint groups for chunk-level indexing. Keys are simprint type identifiers
      (e.g., "CONTENT_TEXT_V0", "SEMANTIC_TEXT_V0"), values are arrays of simprint
      entries with location metadata.

      **Simprint types** are versioned identifiers determining matching strategy and
      abstraction level:
      - `CONTENT_TEXT_V0`: Lexical similarity (near-duplicates, minor edits)
      - `SEMANTIC_TEXT_V0`: Conceptual similarity (paraphrases, translations)
      - `INSTANCE_NONE_V0`: Exact bitstream matches (cryptographic identity)

      **Extensibility**: New simprint types can be added without schema changes.

      **Storage**: Each simprint is indexed with its parent iscc_id, enabling reverse
      lookup from simprint → chunks → assets.
    additionalProperties:
      type: array
      description: Array of simprint entries with location metadata
      items:
        $ref: "./IsccSimprint.yaml"
      minItems: 1
    example:
      CONTENT_TEXT_V0:
        - simprint: "AXvu3tp2kF8mN9qL4rT1sZ"
          offset: 12500
          size: 350
        - simprint: "B4kl9mQ1pP7xY3jH8vW2aF"
          offset: 45230
          size: 412
      SEMANTIC_TEXT_V0:
        - simprint: "CYhq2nR8oL3pT5mK9sX4bG"
          offset: 78900
          size: 389
        - simprint: "D9mn7vT4qK2rU6nL1tY5cH"
          offset: 123450
          size: 301
example:
  iscc_id: "ISCC:MAIGIIFJRDGEQQAA"
  iscc_code: "ISCC:KADUHBUDQUT3LPWRJH6BUAG7HMBIXX6JRQRX3JH7EBIOSMXEVL5URBBUPOIOTU4HLSSQ"
  units:
    - "ISCC:AAAUHBUDQUT3LPWR"
    - "ISCC:CAAUT7A2ADPTWAUL"
    - "ISCC:EAA57SMMEN62J7ZA"
    - "ISCC:GAAVB2JS4SVPWSEE"
    - "ISCC:IAATI64Q5HJYOXFF"
  metadata:
    name: "Digital Philosophy: An Introduction"
    filename: "9788899445566.epub"
    creator: "John Doe"
    publisher: "Tech Press"
  simprints:
    CONTENT_TEXT_V0:
      - simprint: "AXvu3tp2kF8mN9qL4rT1sZ"
        offset: 12500
        size: 350
      - simprint: "B4kl9mQ1pP7xY3jH8vW2aF"
        offset: 45230
        size: 412
    SEMANTIC_TEXT_V0:
      - simprint: "CYhq2nR8oL3pT5mK9sX4bG"
        offset: 78900
        size: 389
      - simprint: "D9mn7vT4qK2rU6nL1tY5cH"
        offset: 123450
        size: 301
