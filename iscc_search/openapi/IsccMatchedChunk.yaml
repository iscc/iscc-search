$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "http://purl.org/iscc/schema/iscc-matched-chunk.json"
title: "IsccMatchedChunk"
type: object
description: |
  Detailed information about a matched content chunk, including similarity metrics
  and optional content preview.

  Extends the basic chunk location data (offset, size) with match-specific information:
  - Query and index simprint comparison
  - Score (0.0-1.0 for soft boundaries, 1.0 for exact matches)
  - Document frequency (rarity measure) for ranking
  - Optional content preview (data URL)
required:
  - query
  - match
  - score
  - freq
  - offset
  - size
properties:
  query:
    type: string
    description: |
      Base64-encoded simprint from the query that matched this chunk.
      In hard-boundary indexes, equals match. In soft-boundary indexes,
      may differ (similar but not identical).
    pattern: "^[A-Za-z0-9+/_=-]+$"
    example: "AXvu3tp2kF8mN9qL4rT1sZ"
  match:
    type: string
    description: |
      Base64-encoded simprint stored in the index that was matched.
      In hard-boundary indexes, equals query. In soft-boundary indexes,
      may differ (within similarity threshold).
    pattern: "^[A-Za-z0-9+/_=-]+$"
    example: "AXvu3tp2kF8mN9qL4rT1sZ"
  score:
    type: number
    description: |
      Similarity score between query and match simprints (0.0-1.0).

      **Hard-boundary indexes**: Always 1.0 (exact collision)
      **Soft-boundary indexes**: NPHD-based similarity (1.0 = identical, 0.0 = maximum distance)

      This field enables forward compatibility with soft-boundary matching.
    minimum: 0.0
    maximum: 1.0
    example: 1.0
  freq:
    type: integer
    description: |
      Document frequency - number of assets containing this simprint.

      Measures simprint rarity: lower values indicate rarer simprints that are
      more discriminative for ranking. Used for IDF-weighted similarity calculations.
    minimum: 1
    example: 42
  offset:
    type: integer
    description: |
      Starting position/time/coordinates in the source content.
      See IsccChunk documentation for modality-specific interpretation.
    minimum: 0
    maximum: 4294967295
    example: 12500
  size:
    type: integer
    description: |
      Extent/duration/dimensions of the content segment.
      See IsccChunk documentation for modality-specific interpretation.
    minimum: 0
    maximum: 4294967295
    example: 350
  content:
    type: string
    pattern: "^data:[^;]+;base64,.+$"
    description: |
      Optional chunk content as data URL (RFC 2397).
      Populated on-demand by fetching from source and extracting the chunk region.
      Useful for match verification and content preview.
    example: "data:text/plain;base64,SWYgd2UgdGhpbmsgb2YgdGhlIGRpZ2l0YWwgd29ybGQgYXMgYSBuZXcgZm9ybSBvZiBwaGlsb3NvcGh5Li4u"
example:
  query: "AXvu3tp2kF8mN9qL4rT1sZ"
  match: "AXvu3tp2kF8mN9qL4rT1sZ"
  score: 1.0
  freq: 42
  offset: 12500
  size: 350
  content: "data:text/plain;base64,SWYgd2UgdGhpbmsgb2YgdGhlIGRpZ2l0YWwgd29ybGQgYXMgYSBuZXcgZm9ybSBvZiBwaGlsb3NvcGh5Li4u"
