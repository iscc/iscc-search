$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "http://purl.org/iscc/schema/iscc-global-match.json"
title: "IsccGlobalMatch"
type: object
description: |
  Asset-level similarity match result.

  Represents a matched asset based on ISCC-UNIT similarity. The score
  is computed as the average of matched unit similarities across all queried units.

  **Score calculation**:
  - Each unit type contributes its similarity (0.0-1.0)
  - Overall score = average across all queried units
  - Example: 5 units with scores [1.0, 1.0, 1.0, 1.0, 0.25] â†’ score = 0.85

  **Properties**:
  - Normalized 0.0-1.0 range (directly comparable across matches)
  - 1.0 = all unit types matched perfectly
  - 0.0 = no matches (should not appear in results)
  - Higher score = better match
required:
  - iscc_id
  - score
  - types
properties:
  iscc_id:
    type: string
    description: The matched ISCC-ID from the index
    pattern: "^ISCC:[A-Z2-7]{16,}$"
    example: "ISCC:MAIGIHJYI3TRSMAB"
  score:
    type: number
    description: |
      Overall score (0.0-1.0), computed as the average of matched
      unit similarities across all queried units.

      This normalized score enables direct comparison across matches regardless
      of the number of units queried.
    minimum: 0.0
    maximum: 1.0
    example: 0.850
  types:
    type: object
    description: |
      Per-unit-type similarity breakdown. Keys are unit type identifiers
      (e.g., "META_NONE_V0", "CONTENT_TEXT_V0"), values are similarity scores (0.0-1.0).

      **Missing keys**: Unit types that were queried but not found in this asset
      are omitted (implicitly 0.0).

      **Score semantics**:
      - 1.0: Exact match (identical units)
      - 0.0-1.0: Similarity match (NPHD distance for similarity-preserving units)
      - Only INSTANCE units with sufficient length guarantee exact identity (cryptographic)
    additionalProperties:
      type: number
      minimum: 0.0
      maximum: 1.0
    minProperties: 1
    example:
      META_NONE_V0: 1.0
      SEMANTIC_TEXT_V0: 1.0
      CONTENT_TEXT_V0: 1.0
      DATA_NONE_V0: 1.0
      INSTANCE_NONE_V0: 0.25
  metadata:
    $ref: "./IsccMetadata.yaml"
    description: |
      Optional asset metadata, denormalized from the index for convenience.
      Useful for result rendering and client-side filtering.
example:
  iscc_id: "ISCC:MAIGIHJYI3TRSMAB"
  score: 0.850
  types:
    META_NONE_V0: 1.0
    SEMANTIC_TEXT_V0: 1.0
    CONTENT_TEXT_V0: 1.0
    DATA_NONE_V0: 1.0
    INSTANCE_NONE_V0: 0.25
  metadata:
    name: "Cyberuomo"
    filename: "9788865882214.epub"
