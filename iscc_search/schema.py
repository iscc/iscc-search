# generated by datamodel-codegen:
#   filename:  openapi.yaml

from __future__ import annotations
from pydantic import BaseModel, ConfigDict, Field
from typing import Annotated, Any
from enum import Enum


class HttpError(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    detail: str | list[str]


class IsccIndex(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    name: Annotated[
        str,
        Field(
            description="Short unique name of the index (valid code identifier)",
            examples=["default"],
            max_length=32,
            min_length=1,
            pattern="^[a-z][a-z0-9]*$",
        ),
    ]
    assets: Annotated[
        int | None,
        Field(description="Number of ISCCs in the index (server-generated, read-only)", examples=[150000], ge=0),
    ] = None
    size: Annotated[
        int | None, Field(description="Size of index in megabytes (server-generated, read-only)", examples=[42], ge=0)
    ] = None


class IsccSimprint(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    simprint: Annotated[
        str,
        Field(
            description="Base64-encoded simprint hash (headerless, variable length).\n\nTypical lengths:\n- 128-bit: 22 chars (base64url without padding)\n- 256-bit: 42 chars (without padding)\n",
            examples=["AXvu3tp2kF8mN9qL4rT1sZ"],
            min_length=16,
            pattern="^[A-Za-z0-9+/_=-]+$",
        ),
    ]
    offset: Annotated[
        int,
        Field(
            description="Starting position/time/coordinates in the source content.\n\n**Interpretation by modality**:\n- Text: UTF-8 byte offset (0-indexed)\n- Audio/Video: Milliseconds from start (0-indexed)\n- Image: Packed coordinates (x << 16 | y)\n\nSee IsccChunk documentation for detailed semantics.\n",
            examples=[12500],
            ge=0,
            le=4294967295,
        ),
    ]
    size: Annotated[
        int,
        Field(
            description="Extent/duration/dimensions of the content segment.\n\n**Interpretation by modality**:\n- Text: UTF-8 byte length\n- Audio/Video: Duration in milliseconds\n- Image: Packed dimensions (width << 16 | height)\n\nSee IsccChunk documentation for detailed semantics.\n",
            examples=[350],
            ge=0,
            le=4294967295,
        ),
    ]


class Status(str, Enum):
    created = "created"
    updated = "updated"


class IsccAddResult(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    iscc_id: Annotated[
        str,
        Field(
            description="The ISCC-ID of the asset that was added to the index (must be provided in add request)",
            examples=["ISCC:MAIGIIFJRDGEQQAA"],
            pattern="^ISCC:[A-Z2-7]{16,}$",
        ),
    ]
    status: Annotated[
        Status,
        Field(
            description='Outcome of the add operation. "created" means asset was newly added to the index,\n"updated" means asset already existed (duplicate skipped via dupdata=False).\n',
            examples=["created"],
        ),
    ]


class IsccMatch(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    iscc_id: Annotated[
        str,
        Field(
            description="The matched ISCC-ID from the index",
            examples=["ISCC:MAIGIIFJRDGEQQAA"],
            pattern="^ISCC:[A-Z2-7]{16,}$",
        ),
    ]
    score: Annotated[
        float,
        Field(
            description="Aggregated score across all unit_types. Metric semantics (bit-length, NPHD distance, etc.)\nare defined at the result collection level, not per match.\n",
            examples=[448],
            ge=0.0,
        ),
    ]
    matches: Annotated[
        dict[str, float],
        Field(
            description='Per-unit_type scores. Keys are unit type names (e.g., "CONTENT_TEXT_V0"),\nvalues are numeric scores whose semantics depend on the search backend\n(bit-length for lookup index, NPHD distance for usearch, etc.).\n',
            examples=[{"CONTENT_TEXT_V0": 256, "DATA_NONE_V0": 128, "INSTANCE_NONE_V0": 64}],
        ),
    ]


class Metric(str, Enum):
    nphd = "nphd"
    hamming = "hamming"
    bitlength = "bitlength"


class IsccEntry(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    iscc_id: Annotated[
        str | None,
        Field(
            description="Globally unique digital asset identifier (ISCC-ID)",
            examples=["ISCC:MAIGIIFJRDGEQQAA"],
            pattern="^ISCC:[A-Z2-7]{16,}$",
        ),
    ] = None
    iscc_code: Annotated[
        str | None,
        Field(
            description="Composite ISCC-CODE combining multiple ISCC-UNITs",
            examples=["ISCC:KECYCMZIOY36XXGZ7S6QJQ2AEEXPOVEHZYPK6GMSFLU3WF54UPZMTPY"],
            pattern="^ISCC:[A-Z2-7]{16,}$",
        ),
    ] = None
    units: Annotated[
        list[str] | None,
        Field(description="List of ISCC-UNITs as canonical strings (variable-length, 64-256 bits)", min_length=2),
    ] = None
    simprints: Annotated[
        dict[str, list[IsccSimprint]] | None,
        Field(
            description='Simprint groups for chunk-level indexing. Keys are simprint type identifiers\n(e.g., "CONTENT_TEXT_V0", "SEMANTIC_TEXT_V0"), values are arrays of simprint\nentries with location metadata.\n\n**Simprint types** are versioned identifiers determining matching strategy and\nabstraction level:\n- `CONTENT_TEXT_V0`: Lexical similarity (near-duplicates, minor edits)\n- `SEMANTIC_TEXT_V0`: Conceptual similarity (paraphrases, translations)\n- `INSTANCE_NONE_V0`: Exact bitstream matches (cryptographic identity)\n\n**Extensibility**: New simprint types can be added without schema changes.\n\n**Storage**: Each simprint is indexed with its parent iscc_id, enabling reverse\nlookup from simprint → chunks → assets.\n',
            examples=[
                {
                    "CONTENT_TEXT_V0": [
                        {"simprint": "AXvu3tp2kF8mN9qL4rT1sZ", "offset": 12500, "size": 350},
                        {"simprint": "B4kl9mQ1pP7xY3jH8vW2aF", "offset": 45230, "size": 412},
                    ],
                    "SEMANTIC_TEXT_V0": [
                        {"simprint": "CYhq2nR8oL3pT5mK9sX4bG", "offset": 78900, "size": 389},
                        {"simprint": "D9mn7vT4qK2rU6nL1tY5cH", "offset": 123450, "size": 301},
                    ],
                }
            ],
        ),
    ] = None
    metadata: Annotated[
        dict[str, Any] | None,
        Field(
            description="Optional application-specific metadata. This field allows clients to store\ncustom data without requiring API changes. The server stores this data\nopaquely without validation.\n",
            examples=[
                {
                    "source": "example.com",
                    "uploaded_by": "user123",
                    "content_type": "image/jpeg",
                    "tags": ["nature", "landscape"],
                }
            ],
        ),
    ] = None


class IsccSearchResult(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    query: Annotated[IsccEntry, Field(description="The original query asset (may include auto-generated iscc_id)")]
    metric: Annotated[
        Metric,
        Field(
            description="Defines the semantics of score values in matches. Different search backends\nuse different metrics (bitlength for lookup, NPHD distance for usearch, etc.).\n",
            examples=["nphd"],
        ),
    ]
    matches: Annotated[
        list[IsccMatch],
        Field(
            description="List of matched ISCC-IDs with scores, ordered by relevance (best first)",
            examples=[
                [
                    {
                        "iscc_id": "ISCC:MAIGIIFJRDGEQQAA",
                        "score": 448,
                        "matches": {"CONTENT_TEXT_V0": 256, "DATA_NONE_V0": 128, "INSTANCE_NONE_V0": 64},
                    },
                    {
                        "iscc_id": "ISCC:MAIGXXFZRDGEQQBB",
                        "score": 384,
                        "matches": {"CONTENT_TEXT_V0": 256, "DATA_NONE_V0": 128},
                    },
                ]
            ],
        ),
    ]
